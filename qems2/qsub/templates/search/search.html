{% extends "base.html" %}

{% block header %}
{% include "header.html" %}
{% endblock %}

{% block sidebar %}
{% include "sidebar.html" %}
{% endblock %}

{% block content %}
{% load static %}
{% load filters %}

<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 text-left">
    <h2 class="page-header">Question Search</h2>
    {% if message %}
    <p class="{{ message_class }}">{{ message }}</p>
    {% endif %}
    <form role="form" method="get" action=".">
        <div class="form-group">
            <label for="id_q">Search: </label>
            <input type="search" id="id_q" name="q" class="form-control" value="{% if search_term %}{{ search_term }}{% endif %}">
        </div>
        <div class="checkbox">
            <label for="id_models_0">Search in:
                <label for="id_models_0">
                    <input checked="checked" id="id_models_0" name="models" type="checkbox" value="qsub.tossup"/>
                    Tossups
                </label>
                <label for="id_models_1">
                    <input checked="checked" id="id_models_1" name="models" type="checkbox" value="qsub.bonus"/>
                    Bonuses
                </label>
            </label>
        </div>
        <div class="form-group">
            <label for="id_qset">Tournament: </label>
            <select class="form-control" id="id_qset" name="qset">
                {% for qset in q_sets %}
                <option value="{{ qset.id }}"
                {% if search_qset %}
                     {% if qset == search_qset %} selected {% endif %}
                {% endif %}>{{ qset.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="id_category">Category: </label>
            <select class="form-control" id="id_category" name="category">
                <option value="All" {% if search_category == "All" %} selected {% endif %}>All Categories</option>
                {% for category in categories %}
                {% with category.0|add:" - "|add:category.1 as cat %}
                <option value="{{ cat }}" {% if search_category == cat %} selected {% endif %}>{{ cat }}</option>
                {% endwith %}
                {% endfor %}
            </select>
        </div>
        <input type="submit" value="Search" class="btn btn-primary">
    </form>
    <p></p>

    {% if result %}

    <table class="table table-striped table-hover tablesorter">
        <caption class="alert alert-info">
            <strong>
                Results
            </strong>
        </caption>
        <thead>
        <tr>
            <th>Author</th>
            <th>Question</th>
            <th>Category</th>
            <th>Packet</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for question in result %}
        <tr>
            <td>{{ question.author }}</td>
            {% if question|class_name == "Tossup" %}
            <td>{{ question.tossup_text|safe}}<br>
                ANSWER: {{ question.tossup_answer|safe }}</td>
            {% elif question|class_name == "Bonus" %}
            <td>
                {{ question.leadin|safe }}<br>
                {{ question.part1_text|safe }}<br>
                ANSWER: {{ question.part1_answer|safe }}<br>
                {{ question.part2_text|safe }}<br>
                ANSWER: {{ question.part2_answer|safe }}<br>
                {{ question.part3_text|safe }}<br>
                ANSWER: {{ question.part3_answer|safe }}<br>
            {% endif %}
            </td>
            <td>{{ question.category }}</td>
            <td>{% if question.packet %} {{ question.packet }} {% else %} Not in packet {% endif %}</td>
            <td>
                <a href="/edit_tossup/{{ result.object.id }}" rel="tooltip" title="Edit tossup">
                    <i class="fa fa-edit"></i>
                </a>
                <a href="/delete_tossup/{{ result.object.id }}" rel="tooltip" title="Delete tossup" class="delete_tossup" value="{{ result.object.id }}">
                    <i class="fa fa-minus-circle"></i>
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No results found.</p>
    {% endif %}
</div>
{% endblock %}
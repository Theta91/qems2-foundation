{% extends "base.html" %}

{% block header %}
{% include "header.html" %}
{% endblock %}

{% block title %}{% if search_term %}{{ search_term }} - Search - QEMS2{% else %}Search - QEMS2{% endif %}{% endblock %}


{% block content %}
{% load static %}
{% load filters %}

<div class="col-xs-10 col-xs-offset-1 col-md-10 col-md-offset-1">
    <h3 class="page-header">Question Search</h3>
    {% if message %}
    <p class="{{ message_class }}">{{ message }}</p>
    {% endif %}
    <form role="form" method="get" action=".">
        <div class="form-group">
            <input type="search" id="id_q" name="q" class="form-control" placeholder="Search Term" value="{% if search_term %}{{ search_term }}{% endif %}">
        </div>
        <div class="checkbox">
            <label for="id_models_0">Search in:
                <label for="id_models_0">
                    {% if tossups_selected == "checked" %}
                        <input checked="checked" id="id_models_0" name="models" type="checkbox" value="qsub.tossup"/>
                    {% else %}
                        <input id="id_models_0" name="models" type="checkbox" value="qsub.tossup"/>
                    {% endif %}
                    Tossups
                </label>
            </label>
            <label for="id_models_1">
                {% if bonuses_selected == "checked" %}
                    <input checked="checked" id="id_models_1" name="models" type="checkbox" value="qsub.bonus"/>
                {% else %}
                    <input id="id_models_1" name="models" type="checkbox" value="qsub.bonus"/>
                {% endif%}
                Bonuses
            </label>
        </div>
        <div class="form-group">
            <label for="id_qset">Tournament: </label>
            <select class="form-control" id="id_qset" name="qset">
                {% for qset in q_sets %}
                <option value="{{ qset.id }}"
                {% if search_qset %}
                     {% if qset == search_qset %} selected {% endif %}
                {% endif %}>{{ qset.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="id_category">Category: </label>
            <select class="form-control" id="id_category" name="category">
                <option value="All" {% if search_category == "All" %} selected {% endif %}>All Categories</option>
                {% for category in categories %}
                {% with category.0|add:" - "|add:category.1 as cat %}
                <option value="{{ cat }}" {% if search_category == cat %} selected {% endif %}>{{ cat }}</option>
                {% endwith %}
                {% endfor %}
            </select>
        </div>
        <input type="submit" value="Search" class="btn btn-primary">
    </form>
    <p></p>

    {% if result %}

    <table class="table table-striped table-hover tablesorter">
        <caption class="alert alert-info">
            <strong>
                Results
            </strong>
        </caption>
        <thead>
        <tr>
            <th>Author</th>
            <th>Question</th>
            <th>Category</th>
            <th>Packet</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% autoescape off %}            
            {% for question in result %}
            <tr>
                <td>{{ question.author }}</td>
                {% if question|class_name == "Tossup" %}
                <td>{{ question.tossup_text|safe|question_html}}<br>
                    ANSWER: {{ question.tossup_answer|safe|answer_html }}</td>
                {% elif question|class_name == "Bonus" %}
                <td>
                    {{ question|bonus_html }}
                {% endif %}
                </td>
                <td>{{ question.category }}</td>
                <td>{% if question.packet %} {{ question.packet }} {% else %} Not in packet {% endif %}</td>
                <td>
                    {% if question|class_name == "Tossup" %}
                    <a href="/edit_tossup/{{ question.id }}" rel="tooltip" title="Edit tossup">
                        <i class="fa fa-edit"></i>
                    </a>
                    <a href="/delete_tossup/{{ question.id }}" rel="tooltip" title="Delete tossup" class="delete_tossup" value="{{ question.id }}">
                        <i class="fa fa-minus-circle"></i>
                    </a>
                    {% elif question|class_name == "Bonus" %}
                    <a href="/edit_bonus/{{ question.id }}" rel="tooltip" title="Edit bonus">
                        <i class="fa fa-edit"></i>
                    </a>
                    <a href="/delete_bonus/{{ question.id }}" rel="tooltip" title="Delete bonus" class="delete_bonus" value="{{ question.id }}">
                        <i class="fa fa-minus-circle"></i>
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        {% endautoescape %}
        </tbody>
    </table>
    {% else %}
    <p>No results found.</p>
    {% endif %}
</div>
{% endblock %}
